const { getExistingIdsFromDrive } = require('./driveManager');
const fs = require('fs');
const path = require('path');
require('dotenv').config();

const USER_IDS_INPUT = `355055, 356557, 362965_357759, 358322, 345968, 345964, 351380, 358754, 347535, 356697_356698, 345664, 357714, 342539, 351567, 351470, 357098, 345925, 346104, 357096_357097, 357093, 346252, 352120, 356957, 351243, 351372, 346758, 350733, 356772, 345992, 351210, 356678, 349786, 356552, 350719, 353006, 346216, 356091, 356666, 356669, 356365, 356098, 347947, 345651, 356019, 354617, 346428, 347678, 350741, 352303, 351045, 355023, 351553, 350611, 353032, 355010, 350553, 347583, 352244, 351021, 350980, 345879, 355015_355016, 345508, 346378, 354874, 351525, 356101, 354024, 350031, 350127, 351766, 345900, 352955, 346377, 351074, 353616, 350715, 351629, 352151, 354412, 346250, 351627, 350716, 353146, 353125, 352127, 351560, 351840, 352169, 357836, 351543, 350919, 350721, 351887, 352422, 347124, 346351, 351500, 354042, 350639, 351344, 346157, 351163, 350562, 351630, 351520, 350707, 354932, 352417, 351588, 351030, 350725, 354405, 346085, 352178, 356028, 353609, 350582, 351864, 352157, 350982, 353005, 352172, 351511, 353499, 350704, 356298, 353002, 352047, 354904, 353072, 351125, 350635, 352048, 350981, 351256, 350133, 350191, 352998, 366001, 355028, 355057, 353016, 356299, 357263, 356031, 351265, 351238, 352418, 354894, 351083, 350134, 355101, 356735, 351242, 350683, 357713, 351881, 351879, 350972, 352376, 352377, 351845, 353021, 360617, 357840, 352259, 351537, 342055, 356958, 351058, 351893, 357880, 359419, 351001, 351043, 351046, 351486, 351039, 351049, 356667, 354902, 350968, 351014, 351038, 350182, 352930, 351931, 350962, 357865, 352956, 350746, 350753, 350724, 350754, 351033, 354901, 359174, 354946, 357841, 358313, 350610, 356705, 350624, 351200, 350920, 350732, 350734, 350621, 350923, 351057, 350630, 350631, 356025, 359798, 357755, 352310, 350137, 351693, 361183, 350139, 350673, 353020, 356694, 352450, 350913, 355026, 351490, 350688, 350109, 357785, 354999_355000, 350626, 351009, 357262, 363115, 351541, 346380, 351007, 350742, 357703, 347136, 350160, 346379, 350738, 350136, 350703, 352338, 342544, 350131, 345898, 347948, 357264_357266, 346211, 347881, 363187, 358903, 355027, 355014, 358479, 357866, 363115_355024, 357533, 359133, 356643, 356052, 357837_357838, 357706, 356273, 356644, 357994, 357079, 356037, 356556, 359793, 359792, 356692, 356693, 355056, 356699, 354578, 356562, 356040, 356246, 357877, 359151, 357878, 351041, 355054_355058, 362973, 359796, 359128, 357590, 359113, 357975, 359141, 358706, 359800_359799, 358117, 358075, 359453, 351515, 356367`;

async function main() {
    const folderId = process.env.GOOGLE_DRIVE_FOLDER_ID;

    const rawIds = USER_IDS_INPUT.split(/[\s,]+/).filter(Boolean);
    const targetIds = new Set();
    rawIds.forEach(idStr => {
        if (idStr.includes('_')) {
            idStr.split('_').forEach(p => targetIds.add(p.trim()));
        } else {
            targetIds.add(idStr.trim());
        }
    });

    const driveItems = await getExistingIdsFromDrive(folderId);

    const matches = [];

    driveItems.forEach(item => {
        if (item.store === 'farm' && item.isFavorito) {
            const match = item.ids.some(id => targetIds.has(id));
            if (match) {
                matches.push(item.ids.join('_'));
            }
        }
    });

    // Output formatted as a comma-separated list or simple list for the user
    console.log(matches.join(', '));
}

main();
